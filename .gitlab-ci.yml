# vars in gitlab-ci env:
# RUNNER_IMAGE: dockerhub.cisco.com/as-dev-docker-local/cisco/cleur21_semops21:v1
stages:
  - test
  - deploy
  # - validate
  - notify

validate:
  image: ${RUNNER_IMAGE}
  stage: test
  script:
    - echo TODO

commit_prod:
  image: ${RUNNER_IMAGE}
  stage: deploy
  # only:
  #   - master
  artifacts:
    paths:
      - results.json
  script:
    - export DNAC_PASSWORD=123
    - python scripts/dnac_templ.py --results results.json --debug

# test:
#   image: ${DOCKER_REPO}/${RUNNER_IMAGE}
#   stage: test
#   script:
#     - echo 'test to be done'

# last step in the pipeline to report status
notify_success:
 image: ${RUNNER_IMAGE}
 stage: notify
 when: on_success
 script:
   # assumes teams token is provided in environment variable
   # WEBEX_API_NOTIFICATION_TOKEN
   - ls -l 
   - python scripts/notify.py  --results results.json "✅ Pipeline completed successfully ($CI_JOB_URL)"

notify_failure:
 image: ${RUNNER_IMAGE}
 stage: notify
 when: on_failure
 script:
   # assumes teams token is provided in environment variable
   # WEBEX_API_NOTIFICATION_TOKEN
   - ls -l
   - python scripts/notify.py  --results results.json "❌ Pipeline failed ($CI_JOB_URL)"
